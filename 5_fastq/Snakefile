configfile: "config.yaml"

rule all:
    input: 
        "reports/multiqc_report_lemons.html"

rule fetch_fastq:
    output:
        directory("fastq_lemons/")
    params:
        names=config["name"]
    shell:
        "parallel-fastq-dump --sra-id {params.names} --threads 16 --outdir {output} --gzip"

rule fastq_qc:
    input:
        "fastq_lemons/{name}.fastq.gz"
    output:
        html="fastq_lemons/qc/{name}_fastqc.html",
        zip="fastq_lemons/qc/{name}_fastqc.zip"
    shell:
        "fastqc -t 16 {input} -o {output}"

rule trim_filter:
    input:
        "fastq_lemons/{name}.fastq.gz"
    output:
        "trimmed_lemons/{name}.fastq.gz"
    shell:
        "cutadapt -j 16 -m 20 --cut 10 -o {output} {input}"

rule trim_qc:
    input:
        "trimmed_lemons/{name}.fastq.gz"
    output:
        html="trimmed_lemons/qc/{name}_fastqc.html",
        zip="trimmed_lemons/qc/{name}_fastqc.zip"
    shell:
        "fastqc -t 16 {input} -o {output}"

rule report:
    input:
        expand(["fastq_lemons/qc/{sample}_fastqc.html", "trimmed_lemons/qc/{sample}_fastqc.html"], sample=config["name"])
    output:
        "reports/multiqc_report_lemons.html"
    shell:
        "multiqc --force -d {input} -n {output}"
