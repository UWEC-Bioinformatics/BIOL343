configfile: "config.yaml"

rule all:
  input: 
    "multiqc_report_lemons.html"

rule fetch_fastq:
    output:
        "fastq_lemons/"
    params:
        names=config["name"]
    shell:
        "parallel-fastq-dump --sra-id {params.names} --threads 16 --outdir {output} --gzip"


rule fastq_qc:
    input:
        "fastq_lemons/{name}.fastq.gz"
    output:
        "fastq_lemons/qc/"
    shell:
        "fastqc -t 16 {input} -o {output}"

rule trim_filter:
    input:
        "fastq_lemons/{name}.fastq.gz"
    output:
        "trimmed_lemons/{name}.fastq.gz"
    shell:
        "cutadapt -j 16 -m 20 --cut 10 -o {output} {input}"

rule trim_qc:
    input:
        "trimmed_lemons/{name}.fastq.gz"
    output:
        "trimmed_lemons/qc/"
    shell:
        "fastqc -t 16 {input} -o {output}"


rule report:
    input:
        "fastq_lemons/qc/"
        "trimmed_lemons/qc/"
    output:
        "multiqc_lemons.html"
    shell:
        "multiqc --force -d {input} {input}"
